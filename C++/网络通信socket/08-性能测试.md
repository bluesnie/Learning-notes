###### datetime:2022/12/29 17:46

###### author:nzb

# 性能测试

## 性能测试的重要性

在实际项目开发中，除了完成程序的功能，还需要测试性能。

在充分了解服务端的性能后，才能决定如何选择服务端的架构，还有网络带宽、硬件配置等。

服务端的性能指标是面试中必问的。

如果不了解系统的性能指标，面试官会认为您没有实际项目开发经验或对网络编程是一知半解。主要的性能指标如下：

- 1）服务端的并发能力
- 2）服务端的业务处理能力
- 3）客户端业务响应时效
- 4）网络带宽

重要的业务系统，最好是与系统管理员和网络管理员一起测试。

## 测试服务端并发性能

服务端最大并发量，即可以接受客户端的最大数量。

注意客户端业务请求不要太频繁。

重视CPU和内存使用率的变化(磁盘I/O, 网络I/O)。

## 测试服务端业务性能

服务端最大业务处理能力，即每秒可以处理的业务请求数量。

注意客户端的数量不要太多。

重视CPU和内存使用率的变化。

## 多进程和多线程服务端性能差异

| 对比维度 | 多进程 | 多线程 | 总结 | 
| ----- | ----- | ----- | ----- | 
| 数据共享、同步 | 数据共享复杂，需要用IPC；数据是分开的，同步简单 | 因为共享进程数据，数据共享简单，但也是因为这个原因导致同步复杂 | 各有优势 | 
| 内存、CPU | 占用内存多，切换复杂，CPU利用率低 | 占用内存少，切换简单，CPU利用率高 | 线程占优 | 
| 创建销毁、切换 | 创建销毁、切换复杂，速度慢 | 创建销毁、切换简单，速度很快 | 线程占优 | 
| 编程、调试 | 编程简单，调试简单 | 编程复杂，调试复杂 | 进程占优 | 
| 可靠性 | 进程间不会互相影响 | 一个线程挂掉将导致整个进程挂掉 | 进程占优 | 
| 分布式 | 适应于多核、多机分布式；如果一台机器不够，扩展到多台机器比较简单 | 适应于多核分布式 | 进程占优 | 

## 多进程和多线程如何选择？

- 1）需要频繁创建销毁的优先用线程  
  
  这种原则最常见的应用就是Web服务器了，来一个连接建立一个线程，断了就销毁线程，要是用进程，创建和销毁的代价是很难承受的
  
- 2）需要进行大量计算的优先使用线程
  
  所谓大量计算，当然就是要耗费很多CPU，切换频繁了，这种情况下线程是最合适的。

  这种原则最常见的是图像处理、算法处理。

- 3）强相关的处理用线程，弱相关的处理用进程

  一般的Server需要完成如下任务：消息收发、消息处理。“消息收发”和“消息处理”就是弱相关的任务，而“消息处理”里面可能又分为“消息解码”、“业务处理”，这两个任务相对来说相关性就要强多了。因此“消息收发”和“消息处理”可以分进程设计，“消息解码”、“业务处理”可以分线程设计。

  当然这种划分方式不是一成不变的，也可以根据实际情况进行调整。  

- 4）可能要扩展到多机分布的用进程，多核分布的用线程

> 需要提醒的是：虽然给了这么多的选择原则，但实际应用中基本上都是“进程+线程”的结合方式，千万不要真的陷入一种非此即彼的误区。

## 测试客户端的响应时间

客户端业务的响应时间，即发出业务请求与收到服务端回应的时间间隔，关系到用户体验。

测试环境包括：
- 业务的闲时/忙时；
- 不同的网络环境（局域网、互联网、移动通信网络）

## 测试网络带宽

测试的目的是根据业务需求，判断出对网络带宽要求。

- 测试网络的有效带宽，方法可以百度。
- 测试网络带宽能承受的业务量，不同的业务对带宽的利用率不一样。要求测试环境的各环节不能存在性能瓶颈，唯一瓶颈就是网络带宽。
注意：
  - 只发送数据，不接收回应
  - 上行和下行分开测试





















